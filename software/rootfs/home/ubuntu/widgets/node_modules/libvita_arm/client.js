// An example Node.JS client using the Socket.IO interface.
//============================================================================

var addon = require('./index.js');
var vita = new addon.create('an2006');

vita.setProperty(0, 0, 99, 0x0000, function(err, data) {});
vita.setProperty(0, 0, 99, 0x0000);

var io = require('socket.io-client').connect('http://localhost:8000', {'force new connection': true});

io.on('message', function(data) {
	console.log('R: '+data);
    data = JSON.parse(data);

    var val = Number(data.payload);

    if (isNaN(val)) return;

    vita.setOutputs(0, 0, val, function(err) {
	    io.send(JSON.stringify({ dest: 'example-channel', payload: err || 'Outputs set to '+val.toString(16)}));
    });
});

io.on('connect', function(data) {
	io.send(JSON.stringify({ dest: 'info', payload: '/join example-channel'}));
	vita.getInputs(0, 0, function(err, data) {
		io.send(JSON.stringify({ dest: 'example-channel', payload: err ? 'e,'+err : 'd,'+data}));
	});

	// var example = require('fs').readFileSync('test.ps');
	// io.send(JSON.stringify({ dest: 'lpr/ryan-arch/Dell_Dell_3335dn_Laser_MFP', payload: example.toString('base64')}));

	setInterval(function() {
	}, 5000);
});
