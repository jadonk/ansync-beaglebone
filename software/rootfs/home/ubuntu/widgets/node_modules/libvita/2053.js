var addon = require('./index');

var dutyCycles = [100, 50, 25, 0, -25, -50, -100,
                    0, 100, 0, -100, 0, 100,
                   -100, 100, -100, 100, -100, 0];

var serials = ["000003", "000001", "000016"];

/*
for (var k = 0; k < 3; k++) {
    addon.open("usb:CLASS_AN2053/" + serials[k], function(err, dev) {
        if (err) {
            console.log(err);
        } else {
            dev.close();
        }
    });
}
*/
addon.open("usb:CLASS_AN2053", function(err, an2053) {
    var interval = null;
    var i = 0;

    if (err) {
        throw err;
    }

    interval = setInterval(function() {
        console.log("Duty cycle: " + dutyCycles[i] + "%");
        an2053.setOutputs(1, 1, dutyCycles[i], function(err) {
            if (err) {
                clearInterval(interval);
                an2053.setOutputs(1, 1, 0);
                throw err;
            }
        });

        i++;
        if (i == dutyCycles.length) {
            clearInterval(interval);
            console.log("Closing . . .");
            an2053.close();
            console.log("Done.");
        }
    }, 2000);
});
